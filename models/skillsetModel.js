const mongoose = require("mongoose");

/* ////////////////////////////////////////////////////////////////////////////////////////////////////
SKILLSET SCHEMA
//////////////////////////////////////////////////////////////////////////////////////////////////// */
const skillsetSchema = new mongoose.Schema(
    {
        user: {
            type: mongoose.Schema.ObjectId,
            ref: "User",
            required: [true, "A skillset must belong to a user."],
            unique: [true, "A user can only have one skillset."], 
        },
        skills: [{
            type: mongoose.Schema.ObjectId,
            ref: "Skill",
        }],
        createdAt: {
            type: Date,
            default: Date.now()
        },
    },
    {
        toJSON: { virtuals: true },
        toObject: { virtuals: true }
    }
);

/* ////////////////////////////////////////////////////////////////////////////////////////////////////
INDEXES. 1 = ascending, -1 = descending
//////////////////////////////////////////////////////////////////////////////////////////////////// */

/* ////////////////////////////////////////////////////////////////////////////////////////////////////
MIDDLEWARE
//////////////////////////////////////////////////////////////////////////////////////////////////// */
skillsetSchema.pre(/^find/, function(next){
    this.populate({
        path: "user",
        select: "name"
    }).populate({
        path: "skills",
        select: "name"
    });
    next();
});

/* ////////////////////////////////////////////////////////////////////////////////////////////////////
SKILLSET MODEL
//////////////////////////////////////////////////////////////////////////////////////////////////// */
const Skillset = mongoose.model("Skillset", skillsetSchema);

/* ////////////////////////////////////////////////////////////////////////////////////////////////////
EXPORTS
//////////////////////////////////////////////////////////////////////////////////////////////////// */
module.exports = Skillset;